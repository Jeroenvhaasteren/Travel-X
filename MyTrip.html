<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- Compiled and minified CSS -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="rescources/Noway-Regular-webfont/stylesheet.css" rel="stylesheet" >
    <link href="style/dist/materialize.css" rel="stylesheet" >
    <link href="style/dist/style.css" rel="stylesheet" >


    <!-- Compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

    <!-- Custom javascript -->
    <script src="js/main.js"></script>

</head>
<body>
<div id="app">
<side-nav></side-nav>

<trip-header :trip="currentTrip"></trip-header>
<!-- Application window -->
<main>

    <section id="appsSpace">
        <trip-info :trip="currentTrip"></trip-info>
        <trip-board :items="board.items"></trip-board>
        <trip-financials></trip-financials>
    </section>

    <div v-show="itemDetails" class="overlay" id="overlay" @click="itemDetails = false"></div>
    <section v-show="itemDetails" class="overlay-modal z-depth-2">
        <trip-item :item="itemDetailsForm"></trip-item>
    </section>

</main>
</div>

<script>
    $(document).ready(function(){
        $('ul.tabs').tabs();
    });
</script>

<!-- Vue Files and Components -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="js/Components/search-bar.js"></script>
<script src="js/Components/side-nav.js"></script>
<script src="js/Components/top-nav.js"></script>
<script src="js/Components/trip-header.js"></script>
<script src="js/Components/trip-info.js"></script>
<script src="js/Components/trip-board.js"></script>
<script src="js/Components/trip-item.js"></script>
<script src="js/Components/trip-financials.js"></script>

<script>
    /** General Vue Instance to share Events and data between components **/
    window.EventChannel = new Vue();

    var root = new Vue({
        el: '#app',
        data: {
            itemDetails: false,
            board: {
                items: [{
                    id: '0',
                    img: 'https://www.barcelona-tourist-guide.com/images/int/attractions/casa-batllo/L/CasaBatllo-4.jpg',
                    title: 'Casa Batllo',
                    desc: 'Web oficial del edificio modernista de Antoni Gaudí en Barcelona Casa Batlló. Información sobre Gaudí y el edificio, visitas, precios, ofertas y eventos.',
                    comments: '0',
                    financials: false,
                    likes: 3,
                    liked: true,
                    url: 'https://www.casabatllo.es/en/'
                }
                ]
            },
            itemDetailsForm: {},
            currentTrip: {
                title: 'SurfTrip Morocco',
                location: 'Morocco',
                from: '',
                till: '',
                img: 'https://s-media-cache-ak0.pinimg.com/originals/bc/f8/bd/bcf8bd824de4a5cdebaabe7ca0a16d0f.jpg'
            }
        },
        methods: {
            addItem: function(url) {
                var urlEncoded = encodeURIComponent(url);
                var apiKey = '58aac6d3dd95e6b920d36457';
                var requestUrl = 'https://opengraph.io/api/1.0/site/' + urlEncoded + '?app_id=' + apiKey;
                var newId = this.board.items.length;
                var newItem = {
                    id: newId,
                    img: '',
                    title: '',
                    desc: '',
                    comments: '0',
                    financials: false,
                    likes: 0,
                    liked: false,
                    url: url
                };
                $.getJSON(requestUrl, function( json ) {
                    newItem.title = json.hybridGraph.title;
                    newItem.desc = json.hybridGraph.description;
                    newItem.img = json.hybridGraph.image;
                });
                this.board.items.push(newItem);
            }
        },
        created: function () {
            var self = this;
            EventChannel.$on('addNewItem', function(url) {
                self.addItem(url);
            });
            EventChannel.$on('openDetailsItem', function(id) {
                self.itemDetails = true;
                self.itemDetailsForm = self.board.items[id];
            })
            EventChannel.$on('updateTrip', function(trip) {
                self.currentTrip = trip;
            });
        }
    });

</script>

</body>
</html>